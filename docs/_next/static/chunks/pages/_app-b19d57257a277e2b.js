(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[888],{6840:function(t,e,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/_app",function(){return a(4798)}])},6197:function(t,e,a){"use strict";a.d(e,{H:function(){return i},a:function(){return l}});var n=a(5893),r=a(7294),o=a(2184),c=a(1163);let s=(0,r.createContext)(void 0);function i(t){let{children:e}=t,[a,i]=(0,r.useState)(null),[l,u]=(0,r.useState)(!0),h=(0,c.useRouter)();(0,r.useEffect)(()=>{let t=localStorage.getItem("token"),e=localStorage.getItem("user");if(t&&e)try{let t=JSON.parse(e);i(t)}catch(t){console.error("Error parsing stored user:",t),localStorage.removeItem("token"),localStorage.removeItem("user")}u(!1)},[]);let d=async(t,e)=>{try{let a=await o.hi.auth.login(t,e);a.success&&(localStorage.setItem("token",a.token),localStorage.setItem("user",JSON.stringify(a.user)),i(a.user),h.push("/chat"))}catch(t){throw console.error("Login error:",t),t}},g=async(t,e,a)=>{try{let n=await o.hi.auth.signup(t,e,a);n.success&&(localStorage.setItem("token",n.token),localStorage.setItem("user",JSON.stringify(n.user)),i(n.user),h.push("/chat"))}catch(t){throw console.error("Signup error:",t),t}};return(0,n.jsx)(s.Provider,{value:{user:a,loading:l,login:d,signup:g,logout:()=>{o.hi.auth.logout(),i(null),h.push("/")},updateUser:t=>{i(t),localStorage.setItem("user",JSON.stringify(t))}},children:e})}function l(){let t=(0,r.useContext)(s);if(void 0===t)throw Error("useAuth must be used within an AuthProvider");return t}},5109:function(t,e,a){"use strict";a.d(e,{R:function(){return l},a:function(){return i}});var n=a(5893),r=a(7294),o=a(2184),c=a(6197);let s=(0,r.createContext)(void 0);function i(t){let{children:e}=t,[a,i]=(0,r.useState)([]),[l,u]=(0,r.useState)(null),[h,d]=(0,r.useState)([]),[g,y]=(0,r.useState)(!1),[m,f]=(0,r.useState)(!0),{user:S}=(0,c.a)(),p=(0,r.useCallback)(async()=>{if(S)try{y(!0);let t=await o.hi.chat.getUserChats();t.success&&i(t.chats)}catch(t){console.error("Error loading chats:",t)}finally{y(!1)}},[S]),v=(0,r.useCallback)(async function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;try{y(!0);let a=await o.hi.chat.getMessages(t,e);a.success&&(1===e?d(a.messages):d(t=>[...a.messages,...t]),f(a.hasMore))}catch(t){console.error("Error loading messages:",t)}finally{y(!1)}},[]),w=(0,r.useCallback)(async function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"text";if(l)try{let a=await o.hi.chat.sendMessage(l._id,t,e);a.success&&d(t=>[...t,a.message])}catch(t){throw console.error("Error sending message:",t),t}},[l]),C=(0,r.useCallback)(async(t,e)=>{try{let a=await o.hi.chat.addReaction(t,e);a.success&&d(e=>e.map(e=>e._id===t?a.message:e))}catch(t){throw console.error("Error adding reaction:",t),t}},[]),k=(0,r.useCallback)(async t=>{if(l)try{y(!0);let e=await o.hi.chat.uploadCSV(l._id,t);if(e.success)return await v(l._id),e.stats}catch(t){throw console.error("Error uploading CSV:",t),t}finally{y(!1)}},[l,v]),E=(0,r.useCallback)(async t=>{if(l)try{let e=await o.hi.chat.updateChatMetadata(l._id,t);e.success&&(u(e.chat),i(t=>t.map(t=>t._id===l._id?e.chat:t)))}catch(t){throw console.error("Error updating chat metadata:",t),t}},[l]);return(0,r.useEffect)(()=>{S&&p()},[S,p]),(0,n.jsx)(s.Provider,{value:{chats:a,currentChat:l,messages:h,loading:g,hasMore:m,setCurrentChat:u,loadChats:p,loadMessages:v,sendMessage:w,addReaction:C,uploadCSV:k,updateChatMetadata:E},children:e})}function l(){let t=(0,r.useContext)(s);if(void 0===t)throw Error("useChat must be used within a ChatProvider");return t}},4798:function(t,e,a){"use strict";a.r(e),a.d(e,{default:function(){return l}});var n=a(5893);a(876);var r=a(6197),o=a(5109),c=a(7294);let s=(0,c.createContext)(null);function i({clientId:t,nonce:e,onScriptLoadSuccess:a,onScriptLoadError:n,children:r}){let o=function(t={}){let{nonce:e,onScriptLoadSuccess:a,onScriptLoadError:n}=t,[r,o]=(0,c.useState)(!1),s=(0,c.useRef)(a);s.current=a;let i=(0,c.useRef)(n);return i.current=n,(0,c.useEffect)(()=>{let t=document.createElement("script");return t.src="https://accounts.google.com/gsi/client",t.async=!0,t.defer=!0,t.nonce=e,t.onload=()=>{var t;o(!0),null===(t=s.current)||void 0===t||t.call(s)},t.onerror=()=>{var t;o(!1),null===(t=i.current)||void 0===t||t.call(i)},document.body.appendChild(t),()=>{document.body.removeChild(t)}},[e]),r}({nonce:e,onScriptLoadSuccess:a,onScriptLoadError:n}),i=(0,c.useMemo)(()=>({clientId:t,scriptLoadedSuccessfully:o}),[t,o]);return c.createElement(s.Provider,{value:i},r)}function l(t){let{Component:e,pageProps:a}=t;return(0,n.jsx)(i,{clientId:"113117749951-4imsu43r36n32ckh9jif9otl3m46nkhv.apps.googleusercontent.com",children:(0,n.jsx)(r.H,{children:(0,n.jsx)(o.a,{children:(0,n.jsx)(e,{...a})})})})}},2184:function(t,e,a){"use strict";a.d(e,{hi:function(){return c}});let n="http://localhost:5001/api",r=()=>{let t=localStorage.getItem("token");return{"Content-Type":"application/json",...t&&{Authorization:"Bearer ".concat(t)}}};async function o(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=await fetch("".concat(n).concat(t),{...e,headers:{...r(),...e.headers}});if(!a.ok)throw Error((await a.json().catch(()=>({error:"Network error"}))).error||"Something went wrong");return a.json()}let c={auth:{signup:async(t,e,a)=>o("/auth/signup",{method:"POST",body:JSON.stringify({name:t,email:e,password:a})}),login:async(t,e)=>o("/auth/login",{method:"POST",body:JSON.stringify({email:t,password:e})}),googleLogin:async t=>o("/auth/google",{method:"POST",body:JSON.stringify({credential:t})}),logout:()=>{localStorage.removeItem("token"),localStorage.removeItem("user")},getCurrentUser:()=>{let t=localStorage.getItem("user");return t?JSON.parse(t):null},getUserByEmail:async t=>{try{let e=await o("/auth/user-by-email/".concat(encodeURIComponent(t)));return e.success?e.user:null}catch(t){return console.error("Error finding user by email:",t),null}}},chat:{createOrGetChat:async(t,e)=>o("/chat/create",{method:"POST",body:JSON.stringify(t.includes("@")?{partnerEmail:t,chatName:e}:{partnerId:t,chatName:e})}),getUserChats:async()=>o("/chat/user-chats"),getMessages:async function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50;return o("/chat/".concat(t,"/messages?page=").concat(e,"&limit=").concat(a))},sendMessage:async function(t,e){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"text";return o("/chat/message",{method:"POST",body:JSON.stringify({chatId:t,text:e,type:a})})},addReaction:async(t,e)=>o("/chat/message/".concat(t,"/reaction"),{method:"POST",body:JSON.stringify({emoji:e})}),uploadCSV:async(t,e)=>{let a=new FormData;a.append("file",e),a.append("chatId",t);let r=localStorage.getItem("token"),o=await fetch("".concat(n,"/chat/upload-csv"),{method:"POST",headers:{...r&&{Authorization:"Bearer ".concat(r)}},body:a});if(!o.ok)throw Error((await o.json().catch(()=>({error:"Upload failed"}))).error||"Failed to upload CSV");return o.json()},updateChatMetadata:async(t,e)=>o("/chat/".concat(t,"/metadata"),{method:"PATCH",body:JSON.stringify(e)})},analytics:{getChatStats:async t=>o("/analytics/".concat(t,"/stats")),getWordCloud:async function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;return o("/analytics/".concat(t,"/wordcloud?limit=").concat(e))},getTimeline:async function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=new URLSearchParams(e).toString();return o("/analytics/".concat(t,"/timeline?").concat(a))},getMilestones:async t=>o("/analytics/".concat(t,"/milestones")),getEmojiStats:async t=>o("/analytics/".concat(t,"/emoji-stats"))},ai:{getRelationshipInsights:async t=>o("/ai/".concat(t,"/relationship-insights")),getConversationStarters:async t=>o("/ai/".concat(t,"/conversation-starters")),getEmojiInsights:async t=>o("/ai/".concat(t,"/emoji-insights")),getDateIdeas:async function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"local";return o("/ai/".concat(t,"/date-ideas?location=").concat(e))},getMemorySummary:async function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"last month";return o("/ai/".concat(t,"/memory-summary?timeframe=").concat(e))},askAboutChatHistory:async(t,e)=>o("/ai/chat/".concat(t,"/ask"),{method:"POST",body:JSON.stringify({question:e})}),getWordFrequency:async(t,e)=>o("/ai/chat/".concat(t,"/word-frequency?word=").concat(encodeURIComponent(e))),getMessagesByDate:async(t,e)=>o("/ai/chat/".concat(t,"/messages-by-date?date=").concat(encodeURIComponent(e)))}}},876:function(){},1163:function(t,e,a){t.exports=a(3079)}},function(t){var e=function(e){return t(t.s=e)};t.O(0,[774,179],function(){return e(6840),e(3079)}),_N_E=t.O()}]);